[TOC]

# 直接数字频率合成(DDS)

## 一   DDS简介

#### **什么是DDS？**

DDS是直接数字频率合成的简称，直接数字频率合成技术以数控振荡的方式，产生频率、相位可控的波形。
DDS利用数字方式累加相位，再以相位之和作为地址来查询正弦函数表得到正弦波幅度的离散数字序列，最后经D/A变换得到模拟正弦波输出。在系统时钟一定的情况下，输出频率决定于频率寄存器中的频率字。而累加器的字长决定分辨率。

#### **为什么要使用DDS？**

传统方法通过晶振产生波形，而此方法有以下缺陷：

- 频率不稳定

- 调频不方便

- 不能构成任意波形

通过DDS技术可以解决以下问题：

- 把输出信号频率稳定度、准确度提高到与基准频率相同的水平

- 可以在很宽的频率范围内进行精细的频率调节。

- 可对输出电平进行调节，也可输出各种波形。

因此，通过DDS产生波形是更好的选择。

## 二    DDS技术原理

#### **1、简单的数字合成系统**

![](https://s1.ax1x.com/2023/02/01/pSBhEuR.png)

如图为简单的数字合成系统，设计数器为N进制计数器，D/A为M位，在每个时钟脉冲，计数器的值+1并输出到ROM的地址线上，这样就可以通过查表得方法找出输出的值。    
若ROM里存储的为正弦波数据（修改存储器的数据可实现输出其他波形），则有：

- 输出信号频率

$$
f=\frac{f_{c p}}{N}
$$

- 输出信号表达式

$$
y=\left(2^{M-1}-1\right)\left(\sin \frac{2 \pi}{N} \cdot x\right)+2^{M-1}, x \in(0, N-1)
$$



#### **2、DDS技术原理**

![](https://s1.ax1x.com/2023/02/01/pSBh1vd.png)
![](https://s1.ax1x.com/2023/02/01/pSBhGDI.md.png)
![](https://s1.ax1x.com/2023/02/01/pSBhdPS.png)
假设相位累加器输出为N=16位，频率控制字为M位，则有：
当M=1时，
$$
f_o=\frac{f_{c p}}{2^N} \times 1=\frac{f_{c p}}{2^{16}}
$$

当M=2时，

$$
f_o=\frac{f_{c p}}{2^N} \times 2=\frac{f_{c p}}{2^{15}}
$$

由此可推导出通式： 

$$
f_o=\frac{f_{c p}}{2^N} \times M
$$

输出信号的分辨率

$$
\Delta f=\frac{f_{c p}}{2^N}
$$

同时，最高合成频率也受奈奎斯特抽样定理的限制，因此有：

$$
f_{o \max }=\frac{f_{c p}}{2}
$$



![](https://s1.ax1x.com/2023/02/01/pSBhWPU.png)
    为了保证在频率变化时，输出的波形点数恒定不变，DDS采用了相位截断技术，即只将相位累加器的高W位送入存储器查表。只有当<mark>相位累加器的输出改变 2^N−W</mark>次时，高W位发生变化，存储器的地址改变，而M通常远小于2^N−W，所以每次存储器的地址改变都需要多个CP脉冲，即<mark>1个CP脉冲内不会出现地址的跳变</mark>，波形存储器的数据不会有间隔的输出，而是保持全部输出，即M值改变时波形的点数不会改变，恒定为<mark>2^W</mark>个点。这种方法对分辨率没有影响，但是会引入截断噪声，使输出频谱产生杂散。
    而在实际应用中，为了获得更高的频率分辨率，通常N取得很大，这就导致存储器查表时消耗的硬件资源通常是不能容忍或不可实现的，会产生更大的截断。
     在现代工业中，已经采用了一定的方法来抑制这些杂散，我们会在（四)中对此进行介绍

## 三    DDS的应用

- #### **任意波形发生器**

​     由于DDS输出信号的分辨率只与相位累加器的位数N有关，输出频率只与频率控制字有关，因此DDS可以通过改变存储器查找表中的数据，输入任意频率，频率和分辨率可调的波形。同时，对于具有复杂调制特性的波形如ASK,FSK,QPSK等波形，也可以通过DDS进行合成。
​     如现在市面上的波形发生器，大多数都是结合了DDS技术和FPGA来实现的。
![](https://s1.ax1x.com/2023/02/01/pSB5MXd.png)

- #### **在通信领域的应用**

​    在数字通信网和计算机网络中各站点为了进行分路和并路，必须调整各个方向送来的信码的速率和相位，使之步调一致，这种调整过程称为网同步。
​    在网同步电路中，通常使用DDS技术进行方便、精准的频率合成，调整输出频率，最终使来自不同方向的信号收敛至同一个时钟上。
此外，当检测到输入时钟丢失时， CPU用丢失前的频率控制字来控制DDS的输出频率，使得时钟频率一直保持输入时钟丢失前的频率，同时，CPU把这些频率控制字保存于非易失存储器中，<mark>与电路中的掉电保存功能类似。</mark>
![](https://s1.ax1x.com/2023/02/01/pSB5GAP.png)

- #### **在电子战中的应用**

​    当今世界，国家间的电子战越来越激烈，DDS技术在信号干扰方面其中巨大的作用。
​    在干扰机中 , 对雷达干扰的一个重要方法就是对接收到的雷达信号频率进行适当的移频调制 ,从而破坏或扰乱敌人对目标的检测与跟踪。所以 ,在新型的干扰机中充分利用DDS独特的优点来实现移频，使得己方能发射出多变而不易被识别的干扰信号，提高信息安全性。

## 四   DDS中的杂散抑制

#### **理想DDS和非理想DDS**

理想DDS

- 延时叠加法
- D/A转换不存在量化误差
- 使用理想滤波器

​    理想的DDS系统需满足上图三个条件，然而在实际应用中，这是不可能实现的，这会使系统不可避免地产生噪声，导致输出频谱产生杂散。

   通常通过改善硬件、抖动注入法、延时叠加法三种方式来抑制杂散。

- #### **改善硬件**

通过（二）中对DDS技术的介绍，我们知道在实际应用中，DDS会用到相位截断技术，若相位累加器为N位，累加器输出的高W位被用于查表，则该系统有B=N-W位被截断，查阅文献得知，截断位数产生的噪声公式如下：
                                                    β(ⅆB)=20lg2^B−N+20lgπ/2=6.02(B−N)+3.922
由上式可知，相位截断B每增加一位，产生的杂散增加6.02dB,为了减小截断噪声，可以增大ROM的容量或者减少截断位数以减小杂散，但受硬件条件影响，这种方式作用比较有限。

- #### **抖动注入法**

  抖动注入法的基本思想是将噪声的单根谱线平均到整个频谱，使杂散信号变为幅度较低的噪声，而改善总的信号频谱质量 , 可以有效的抑制杂散信号 。有频率抖动、幅度抖动和相位抖动三种方法，基本方法为向信号加入一段随机序列以打破噪声的周期性，进而降低杂散，其示意图如下
![](https://s1.ax1x.com/2023/02/01/pSBoCZR.png)
  通常通过相位抖动注入法改善相位截断引起的杂散；幅度抖动注入法改善D/A的量化误差引起的杂散
  由于相位截断是DDS最主要的杂散来源，因此比较常用的是相位抖动注入法

  由于相位截断中舍弃了累加器输出的后N-W位，因此在进行查表时可能会因出错而产生噪声
  因此，相位抖动注入法在进行查表前，注入一段N−W位的随机干扰序列，实验结果如下所示：
![](https://s1.ax1x.com/2023/02/01/pSBorWT.png)
![](https://s1.ax1x.com/2023/02/01/pSBogOJ.png)
由图可知，相位抖动注入法在改善杂散的同时，也会抬高噪声基底，但这种代价对于整体频谱质量的提高是完全值得的，这种方法被广泛用于芯片生产，<mark>如高通公司早在1997年的Q2334中就采用了抖动注入技术。</mark>

- #### **延时叠加法**

对于主频附近的边带杂散，可通过延时叠加法抑制杂散。延时叠加法通过两片DAC芯片，将信号进行延时t′后进行叠加，示意图如下：
![](https://s1.ax1x.com/2023/02/01/pSBoTSO.png)
设                      S_1(t)=c_0cos2πf_0t+c_1cos(ωt+φ)
                          S_2(t)=c_0cos2πf_0(t−t′)+c_1cos(ω(t−t′)+φ)
其中c_0， c_1为信号和噪声的幅度， c_1 cos(ωt+φ)为噪声表达式
叠加后输出

​                      S_3(t)= S_1(t)+ S_2(t)=2c_0cosω_0t′/2cos(ω_0t+θ_1)+ 2c_1cosωt′/2cos(ωt+θ_2)
叠加前的信噪比SNR_1=20lgc_0/c_1，叠加后的信噪比SNR_2=20lgc_0cosω_0t′/2/c_1cosωt′/2= 20lgc_0/c_1+M
可知，通过调整延时时间t′，理论上可以使信噪比接近无穷大，但由于器件的性能限制，实际的信噪比也是有限的，但也能够有效抑制杂散。
  <mark>现阶段有部分芯片可以支持这种方法，如含有四路DAC的AD9016，可以通过编程达成这种方法</mark>

## 第九章   频率合成

### **锁相环技术及其运用**

基础知识——数字电子技术
在数字系统当中，产生时钟信号就是采用石英晶体。
原理：将石英晶体打磨成很薄的石英晶体斜切片，越薄振荡频率越高。
优点：产生的信号频率f非常稳定。

**问题1：频率极限**
石英晶振可产生频率有限，最高只有200MHz，因为当石英晶体切片过薄时会变得很脆，进而无法起振。 但在各种数字系统当中所需时钟信号频率越来越高(GHz)。
**问题2：任意分频**
同一系统中只提供一个总的时钟信号，但各不同部件所需时钟频率不同，计数器只能实现整数分频。

- 数字电视系统

> - 标清(SDI)
> 
> > - 标串行时钟：270MH清(SDI)
> > - 并行时钟：27MHz

> - 高清(HDI)
> 
> > - 串行时钟1.485GH
> > - 并行时钟：74.25MHz

> - 音频时钟：48kHz
> - 位时钟：12.88MHz



---

#### **1.锁相环结构及原理**

**锁相环一般由三部分组成：**

- 鉴相器(PD)：在模拟电路中一般为模拟乘法器；在数字电路中一般为数字鉴相器。

- 环路滤波器(LF)：实质为低通滤波器。

- 压控振荡器(VCO)：输出信号频率与输入电压有对应关系的振荡电路

  **锁相环核心：反馈**
  ![](https://pic.imgdb.cn/item/63da14dfac6ef86016eac5df.png)
  **鉴相器(PD)**
  又称为相位比较器
  作用：检测输入信号和输出信号的相位差，并转换成电压信号输出，对振荡器输出信号的频率实施控制。
  ![](https://pic.imgdb.cn/item/63da1532ac6ef86016eb960a.png)
  **环路滤波器(LF)**
  本质是低通滤波器。
  作用：过滤掉和频分量，剩下的差频分量作为压控振荡器的输入控制电压。
  ![](https://pic.imgdb.cn/item/63da1561ac6ef86016ebdfe4.png)
  **压控振荡器(VCO)**
  作用：由输入电压控制输出频率。

#### **锁相环工作原理**

- **锁定**：此时锁相环的输出信号频率与输入信号频率相等，存在相位差，锁相环输出频率不变。即f0=fi，此时幅值可不一致，相位差保持不变。
- **跟踪**：此时锁相环的输出频率可以跟随输入频率的变化，并达到锁定状态。即f0随fi变化，为负反馈。
- **失锁**：频率变化太快，此时锁相环的输入频率与输出频率无关，输出频率为压控振荡器中心频率。

​                   设输入信号：U_i(t)=U_msin(ω_it+θ_i)      输出信号： U_o(t)=U_omsin(ω_ot+θ_o)
​                    当ω_i=ω_o时，鉴相器输出含和频域直流成分，无差频信号
​                    U_D(t)=KU_o(t)U_i(t)=1/2KU_mU_omsin[(ω_it+θ_i)+(ω_ot+θ_o)]+1/2KU_mU_omsin[(ω_it+θ_i)−                              (ω_ot+θ_o)]=1/2KU_mU_omsin[(ω_it+θ_i)+(ω_ot+θ_o)]+1/2KU_mU_omsin(θ_i−θ_o)
​                     经过环路滤波器后滤掉和频成分，剩下控制信号1/2KU_mU_omsin(θ_i−θ_o) ，是不随时间变化的直流量，

![](https://pic.imgdb.cn/item/63da1561ac6ef86016ebdfe4.png)
锁相环电路处于锁定状态时，此时输入信号跟输出信号之间存在相位差∆θ，当输入信号的频率改变时，瞬时相位差也会改变，使得输出频率更加接近输入频率，达到稳频，是一个负反馈系统。
右图所示为压控振荡器的控制特性曲线。从曲线可知，因为正弦波电压值有正有负，所以压控振荡器的输入电压U_C可以增加，也可以减小。跟踪关系如下：
ω_i↓⇒Δθ↓⇒U_c↓⇒ω_o↓
ω_i↑⇒Δθ↑⇒U_c↑⇒ω_o↑

当输入信号变的时候，突然输出信号跟不上输入信号的变化，输出信号和输入信号的频率不相等现象。当输入信号频率产生突变的时候有可能失锁。

失锁原因：使得（ω_i−ω_o）/2π 大于环路滤波器的截止频率，所以鉴相器输出的和频与差频都被环路滤波器滤除，压控振荡器的输入信号为0，导致锁相环输出频率为压控振荡器中心频率，与输入信号无关。

锁相环是在某个频率附近的一定范围内工作，相当于高频电子线路中的调频波FM和载波，调频是在载波频率的周围变化。因此锁相环广泛用于调频波的调制领域

---

#### **2.锁相环应用**

**锁相环路的重要特性**

- 跟踪特性:一个已锁定环路，当输入信号频率f_R稍有变化时，VCO频率立即发生相应变化，最终使f_V=f_R。
- 滤波特性:由于环路滤波器的作用，锁相环具有窄带滤波特性，能够将混进信号中的噪声和杂散干扰滤除。设计良好时通带可以做到极窄。
- 锁定状态:无剩余频差锁相环利用相位比较来产生误差电压，因而锁定时只有剩余相差，没有剩余频差。
- 易于集成:锁相环路基本部件易于采用模拟集成电路。环路实现数字化后，更易于采用数字集成电路。

**锁相环的应用**

- **倍频与分频**

![](https://pic.imgdb.cn/item/63da16adac6ef86016ee5ba2.png)
f_p=f_out/M=f_e=f_r/N ⇒f_out=M/N∙f_r

![](https://pic.imgdb.cn/item/63da16edac6ef86016eec26c.png)
PFD比较输入时钟和反馈时钟的相位，输出它们的差值。电荷泵和环路滤波器将差值转换成电压。VCO基于电压产生更高或者更低的频率振荡，从而影响反馈时钟的相位和频率。反馈机制最终迫使反馈时钟和参考时钟有相同的频率和相位，即锁相。PLL中有几个分频器，通过调整分频器的值进行频率综合，也可以通过相位选择电路(PS)来调整输出时钟的相位。 输出时钟的频率是：
F_OUT0=F_VCO/C_0=M/N∙C_0∙F_in

- **调频与解调**
  ![](https://pic.imgdb.cn/item/63da16edac6ef86016eec26c.png)
  设输入的调频信号为：
  v_1(t)=V∙sin[ω_0t+k_f∫v_Ω(t)dt]=V∙sin[ω_0t+θ_1(t)]
  式中，θ_1(t)=k_f∫▒v_Ω(t)dt；k_f为调频比例系数；v_Ω(t)为调制信号电压。
  锁相环路的环路误差传输函数为：θ_e(s)=[1/s+KF(s)]sθ_1(s)。式中括号项代表环路的等效滤波作用，sθ_1(s)项表示原来的调制信号。
  由拉普拉斯变换反变换： sθ_1(s)⇔ⅆθ_1(t)/ⅆt=k_fv_Ω(t)，则θ_e(t)∝ⅆθ_1(t)/ⅆt∝k_fν_Ω(t)。故误差相位θ_e(t)与调制信号电压成正比。通过鉴相器的关系式，得ν_d(t)=K_dθ_e(t)∝K_dk_fv_Ω(t)。
  因此，鉴相器的输出电压ν_d(t)正比于原来的调制信号v_Ω(t)。由于直接从鉴相器输出端取出解调信号,解调输出中有较大的干扰与噪声。通常要经过环路滤波器进一步滤波后再输出。
- **锁相接收机**
  ![](https://pic.imgdb.cn/item/63da1821ac6ef86016f0d026.png)
  锁相接收机原理：调频高频信号(中心频率为f_1)与频率为f_2的外差本振信号相混频。本振信号f_2是由VCO频率f_2/N经N次倍频后所供给的。混频后，输出中心频率为f_3的信号，经过中频放大，在鉴相器内与一个频率稳定的参考频率f_4进行相位比较。经鉴相后，解调出来的单音调制信号直接通过环路输出端的窄带滤波器输出。由于环路滤波器的带宽选得很窄，因此鉴相器输出中的调制信号分量不能进人环路。但以参考频率f_4为基准的已调信号的载频发生漂移时，它所对应的鉴相器直流输出控制电压却能够进人环路，来控制VCO的振荡频率，使混频后的中频已调信号的载频漂移减小，以至到零。显然,在锁定状态下,必有f_3 =f_4 。因此，窄带跟踪环路的作用就是使载频有漂移的已调信号频谱,经混频后，能准确地落在中频通频带的中央。
- **载波同步**
  ![](https://pic.imgdb.cn/item/63da18c9ac6ef86016f1ddf4.png)
  同相正交环：
  接收信号被分别送到上下两个支路的两个鉴相器上，上支路与VCO正交鉴相，下支路与经90°相移的VCO输出同相鉴相。上下鉴相器输出经低通滤波后相乘，获得误差电压经环路滤波后控制VCO相位与频率。
  误差电压:
  v_d=1/8m^2(t)sin2(φ−θ)

#### **3.全数字环简介**

**DEPL概念**
    随着数字电路技术的发展，数字锁相环在调制解调、频率合成、FM 立体声解码、彩色副载波同步、图象处理等各个方面得到了广泛的应用。数字锁相环不仅吸收了数字电路可靠性高、体积小、价格低等优点，还解决了模拟锁相环的直流零点漂移、器件饱和及易受电源和环境温度变化等缺点，此外还具有对离散样值的实时处理能力，已成为锁相技术发展的方向。
**DEPL分类**

- 触发器型(FF-DPLL)：利用一双稳态触发器作数字鉴相器，其状态分别受输入信号与本地受控时钟信号的正向过零点触发，产生位置与复位脉冲状态变化之间的间隔就反映着两信号之间的相位误差
- 奈奎斯特型(NR-DPLL)：在输入信号进入数字鉴相器之前，先以奈奎斯特速率(固定速率的时钟脉冲)进行抽样，然后再与本地受控时钟信号进行数字相乘，产生数字式相位误差。
- 过零检测式(ZC-DPLL)：环路用本地受控时钟脉冲对输入信号的过零点抽样，非零的实际抽样值大小就反映着相位误差，用该相位误差来调节本地时钟信号的相位。
- 超前滞后型(LL-DPLL)：鉴相器将逐周期地比较输入信号与本地时钟信号的相位，根据相位的超前或滞后输出相应的超前或滞后脉冲，再变换成加脉冲或减脉冲，对应地调节本地时钟相位。

**数字鉴相器（DPD)**

- **触发器型数字鉴相器:**

当检测到输入信号正向过零点时，触发器置“1”，而本地参考信号正向过零点使触发器置“0”复位。两正向过零点之间间隔可控制高速时钟计数。时钟频率2^mf_0，其中f_0输入信号中心频率。
![](https://pic.imgdb.cn/item/63da19c9ac6ef86016f3cdb8.png)
![](https://pic.imgdb.cn/item/63da19cbac6ef86016f3d098.png)

- **奈奎斯特速率抽样鉴相器:**

模数变换器(A/D)的采样速率按带通信号的取样定理选择，以使取样后信号含有充分的输入信号相位信息。通常抽样率不小于A/D前置带通滤波器的带宽的两倍。抽样量化后的信号与本地受控时钟信号进行相乘产生数字相差信号。低速运用时也可用微处理器作数字相乘器，并兼备数字环路滤波器与数字钟(DCO)的功能。

- **过零取样鉴相器**

正过零点取样型：所有数字鉴相器中最简单的，易于实现

- **超前滞后取样鉴相器**

以简单的二元鉴相表示这种鉴相器。通过输入信号与本地参考信号(受控脉冲信号)之间的比相，形成超前或滞后脉冲输出。典型二元鉴相器电路一般是采用同相和中相积分来实现的。
![](https://pic.imgdb.cn/item/63da1a6bac6ef86016f4f467.png)
超前脉冲意味着本地参考信号相位落后，超前脉冲的作用即将本地参考信号相位提前。
滞后脉冲表示输入信号相位落后，其作用将本地参考信号相位推后。

**数字环路滤波器（DLF）**
数字环中使用数字环路滤波器与模拟环中使用的环路滤波器一样，都是对噪声及高频分量起抑制作用，并且控制着环路相位校正的速度与精度。适当选择环路滤波器参数可以抑制改变环路性能。
数字环路滤波器一般构成形式如右图，它由A/D、数字计算器和D/A三部分组成。
A/D将输入样值变换为相应的二进制数字代码序列；
数字计算器按照要求的滤波性能对输入数字代码进行数字计算与处理；
D/A运算处理后的代码变换为样值输出。
注意：实时处理要在取样间隔内完成。
通常也可以不用A/D与D/A数字计算器可直接对输出样值进行存储可和计算，即数字滤波器的模拟实现形式。
 **数控振荡器（DCO）**
数字压控振荡器由以下三部分组成：频率稳定的信号钟、计数器、比较器。其输出是一取样脉冲序列，脉冲周期受数字环路滤波器送来的校正电压控制。前一个取样时刻的校正电压将改变下一个取样时刻的脉冲时间的位置。
DCO在环路中又称为本地受控时钟或本地参考时钟信号
计数器记录信号钟的脉冲数目，直至记录到其总数与加到比较器的控制电压y_k+E_0相对应，比较器才产生复位脉冲输出。其中：

​      1.E_0：固定偏压，对应输出复位脉冲周期为T_0
​      2.y_k：DLF输出的校正电压，控制输出取样脉冲的周期

DCO数学表达：T_k=T_o−T_o/N∙y_k−1
式中，T_o/N为DCO周期相对于中心周期T_o变化的最小单位
无控制时：y_k−1=0，T_k=T_o
有控制室，周期以±T_o/N或其倍数的量相对于T_o作阶跃式的改变。
与T_o/N相对应的相位改变量：
Δ=2π/N (rad/s)
N：模2π内状态数，表示2π弧度内相位受控变化大小。
DCO输出脉冲瞬时相位θ_o(k)，在2π弧度内只能以Δ或其倍数离散地变化。显然有：
T_o/N=T_c⇒N=T_o/T_c
T_c：信号钟的周期。

其他常用DCO方案：
信号钟产生频率f_c=mf_o的窄脉冲序列，经控制器加置分频比为m的分频器上，分频后输出频率f_o
环路输入信号比DCO信号相位落后时，鉴相器经环路滤波器输出一个“推后”脉冲到控制器，扣除一个通过它的时钟脉脉冲，分频后输出脉冲相位推后1/m周期。
反之，鉴相器经环路滤波器输出一个“提前”脉冲到控制器，控制器向信号中输入的脉冲序列中插入一个脉冲，分频后输出脉冲相位提前1/m周期。







